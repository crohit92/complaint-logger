<div class="app-complaints-list">
    <div class="mat-title flex flex-align-items-center">Your Complaints <button [routerLink]="['../raise']"
            routerLinkActive="router-link-active" color="warn" mat-button>
            <mat-icon>add</mat-icon> Add new
        </button></div>
    <mat-tab-group (selectedIndexChange)="tabChanged($event)">
        <mat-tab label="Pending ({{pendingComplaintsCount}})">
            <div class="pending-complaints">
                <div class="complaint" *ngFor="let complaint of pendingComplaints">
                    <ng-container [ngTemplateOutlet]="complaintTemplate"
                        [ngTemplateOutletContext]="{$implicit:complaint}"></ng-container>
                </div>
            </div>
            <div class="pending-pagination">
                <mat-paginator (page)="pendingPageChanged($event)" [length]="pendingComplaintsCount"
                    [pageSize]="pageOptions.pageSize" [pageSizeOptions]="[5, 10, 25, 100]">
                </mat-paginator>
            </div>

        </mat-tab>
        <mat-tab label="Resolved ({{resolvedComplaintsCount}})">
            <div class="resolved-complaints">
                <div class="complaint" *ngFor="let complaint of resolvedComplaints">
                    <ng-container [ngTemplateOutlet]="complaintTemplate"
                        [ngTemplateOutletContext]="{$implicit:complaint,resolved:true}"></ng-container>
                </div>
            </div>
            <div class="resolved-pagination">
                <mat-paginator (page)="resolvedPageChanged($event)" [length]="resolvedComplaintsCount"
                    [pageSize]="pageOptions.pageSize" [pageSizeOptions]="[5, 10, 25, 100]">
                </mat-paginator>
            </div>
        </mat-tab>
    </mat-tab-group>
</div>

<ng-template #complaintTemplate let-complaint let-resolved="resolved">
    <div class="complaint__header">
        <div class="complaint__header-department">
            {{complaint.department?.name}}
        </div>
        <div class="complaint__header-location">
            {{complaint.building?.label}} - {{complaint.room}}

        </div>
        <div class="complaint__header-created-at">
            <!-- {{complaint.building?.name}} -->
            {{complaint.createdAt}}
        </div>
    </div>
    <div class="complaint__body">
        {{complaint.description}}
    </div>
    <mat-divider></mat-divider>
    <div class="complaint__status">
        <div class="complaint__status-assigned-to">
            Assigned to: <span>{{complaint.assignedTo?complaint.assignedTo?.name:'Not assigned'}}</span>
            <a *ngIf="complaint.assignedTo?.mobile" href=tel:{{complaint.assignedTo?.mobile}}>
                <mat-icon>call</mat-icon>
            </a>
        </div>
    </div>
    <div class="technician-remarks">
        <div class="resolution-comments">
            <div class="mat-subtitle">Comment History</div>
            <mat-divider></mat-divider>
            <div class="comment" *ngFor="let comment of complaint.comments">
                {{comment.by}}: {{comment.description}}
            </div>
            <div class="new-comment">
                <textarea #commentDescription placeholder="Add new comment"></textarea>
                <mat-icon (click)="addComment(complaint,commentDescription)">add</mat-icon>
            </div>
            <mat-divider></mat-divider>
        </div>
    </div>
</ng-template>